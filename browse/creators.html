<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Creators - MIX Data Browser</title>
  <link rel="stylesheet" href="../css/browser-common.css">
</head>
<body>
  <div class="container">
    <header>
      <div>
        <a href="../index.html" class="back-link">â† Back to Browser</a>
        <h1>ğŸ‘¤ Creators</h1>
        <p class="subtitle">Creator profiles and their content</p>
      </div>
      <div class="header-actions">
        <button class="dark-mode-toggle" id="dark-mode-toggle">
          <span id="dark-mode-icon">ğŸŒ™</span>
          <span id="dark-mode-label">Dark</span>
        </button>
      </div>
    </header>

    <div class="table-container">
      <div id="table-container">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading creators...</p>
        </div>
      </div>
    </div>
  </div>

  <script type="module">
    import { fetchCollection, escapeHtml } from '../js/firestore-browser.js';
    import { renderTable, sortData, showError } from '../js/table-utils.js';

    // Column configuration
    const columns = [
      { key: 'name', label: 'Name', type: 'text' },
      { key: 'description', label: 'Description', type: 'text', truncate: 100 },
      { key: 'imagePath', label: 'Image', type: 'thumbnail' },
      {
        key: 'link',
        label: 'Link',
        type: 'text',
        render: (value) => {
          if (!value) return '<span class="text-muted">â€”</span>';
          const escaped = escapeHtml(value);
          return `<a href="${escaped}" target="_blank" rel="noopener" style="color: #3b82f6;">${escaped}</a>`;
        }
      }
    ];

    let creatorsData = [];

    async function loadCreators() {
      try {
        creatorsData = await fetchCollection('creators', {
          maxResults: 100
        });

        renderTable('table-container', creatorsData, columns, {
          onSort: handleSort
        });
      } catch (error) {
        showError('table-container', 'Failed to load creators: ' + error.message);
      }
    }

    function handleSort(key, direction) {
      const sorted = sortData(creatorsData, key, direction);
      renderTable('table-container', sorted, columns, {
        onSort: handleSort
      });
    }

    // Dark mode toggle
    const toggle = document.getElementById('dark-mode-toggle');
    const icon = document.getElementById('dark-mode-icon');
    const label = document.getElementById('dark-mode-label');

    if (localStorage.getItem('darkMode') === 'true') {
      document.body.classList.add('dark-mode');
      icon.textContent = 'â˜€ï¸';
      label.textContent = 'Light';
    }

    toggle.addEventListener('click', () => {
      document.body.classList.toggle('dark-mode');
      const isDark = document.body.classList.contains('dark-mode');
      localStorage.setItem('darkMode', isDark);
      icon.textContent = isDark ? 'â˜€ï¸' : 'ğŸŒ™';
      label.textContent = isDark ? 'Light' : 'Dark';
    });

    // Load data
    loadCreators();
  </script>
</body>
</html>
